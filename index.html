<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂéòÁ±≥ÊµãÈáèÂ§ßÈóØÂÖ≥</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial Rounded MT Bold', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%);
            color: #2d5016;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: row;
            gap: 30px;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            width: 100%;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #2d5016;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .game-area {
            flex: 2;
            display: flex;
            flex-direction: column;
        }
        
        .workbench {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            flex: 1;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 2px solid #a8e6cf;
            min-height: 400px;
        }
        
        .workbench-title {
            text-align: center;
            margin-bottom: 20px;
            color: #4a7c59;
            font-size: 1.5rem;
        }
        
        .rod {
            height: 40px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            cursor: grab;
            transition: transform 0.3s;
            position: absolute;
            z-index: 10;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 0;
            transform-origin: 0 0;
        }
        
        .rod:active {
            cursor: grabbing;
        }
        
        .rod-1 {
            background: linear-gradient(90deg, #a8e6cf, #88d3a7);
            width: 180px; /* 6cm */
        }
        
        .rod-2 {
            background: linear-gradient(90deg, #7bcfa7, #5cb38b);
            width: 150px; /* 5cm */
        }
        
        /* Á¨¨‰∏âÂÖ≥ÁöÑÂ∞èÊ£íÊ†∑Âºè */
        .rod-small {
            height: 25px;
            display: flex;
            align-items: center;
            padding: 0 5px; /* ÂáèÂ∞ëÂÜÖËæπË∑ù */
            cursor: grab;
            transition: transform 0.3s;
            position: absolute;
            z-index: 10;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 0;
            transform-origin: 0 0;
            justify-content: center; /* ÊñáÂ≠óÂ±Ö‰∏≠ */
        }
        
        .rod-1cm { 
            width: 30px;  /* 1cm = 30px */
            background: linear-gradient(90deg, #FF6B6B, #FF8E8E); 
        }
        .rod-2cm { 
            width: 60px;  /* 2cm = 60px */
            background: linear-gradient(90deg, #4ECDC4, #45B7D1); 
        }
        .rod-3cm { 
            width: 90px;  /* 3cm = 90px */
            background: linear-gradient(90deg, #FFD166, #FFB347); 
        }
        .rod-4cm { 
            width: 120px; /* 4cm = 120px */
            background: linear-gradient(90deg, #06D6A0, #00C897); 
        }
        .rod-5cm { 
            width: 150px; /* 5cm = 150px */
            background: linear-gradient(90deg, #118AB2, #0A7EA6); 
        }
        .rod-6cm { 
            width: 180px; /* 6cm = 180px */
            background: linear-gradient(90deg, #9B5DE5, #7E43C0); 
        }
        
        .rod-label {
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            font-size: 0.65rem; /* Ëøõ‰∏ÄÊ≠•Áº©Â∞èÂ≠ó‰Ωì */
            white-space: nowrap;
        }
        
        .ruler-container {
            width: 360px; /* 12cm (10cmÂàªÂ∫¶+Â∑¶Âè≥ÂêÑ1cmÁ©∫Èó¥) */
            height: 80px;
            background: #f9e9b6; /* ÊµÖÈªÑËâ≤ */
            border-radius: 8px;
            position: absolute;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            cursor: grab;
            z-index: 5;
            border: 1px solid #d4c18a;
            transform-origin: 0 0;
        }
        
        .ruler {
            height: 100%;
            width: 300px; /* 10cm */
            background: #f9e9b6;
            position: relative;
            user-select: none;
            margin: 0 auto;
        }
        
        .ruler:active {
            cursor: grabbing;
        }
        
        .ruler-line {
            position: absolute;
            width: 1px;
            background: #333;
            bottom: 0;
            height: 10% !important; /* ÊâÄÊúâÂàªÂ∫¶Á∫øÁªü‰∏ÄÈ´òÂ∫¶ */
        }
        
        .ruler-number {
            position: absolute;
            bottom: 5px;
            font-size: 14px;
            font-weight: bold;
            color: #333;
            transform: translateX(-50%);
        }
        
        .control-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 10px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 2px solid #a8e6cf;
        }
        
        .level-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .zoom-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
        }
        
        .zoom-label {
            font-weight: bold;
            color: #2d5016;
            white-space: nowrap;
            font-size: 0.9rem;
        }
        
        .zoom-slider {
            width: 100px;
        }
        
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(90deg, #4a7c59, #3a6b49);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            font-size: 0.9rem;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
            background: linear-gradient(90deg, #5cb38b, #4a7c59);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button.active {
            background: linear-gradient(90deg, #2d5016, #4a7c59);
            box-shadow: 0 0 0 2px #a8e6cf;
        }
        
        .quiz-area {
            flex: 1;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 2px solid #a8e6cf;
            display: flex;
            flex-direction: column;
        }
        
        .quiz-title {
            color: #4a7c59;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #a8e6cf;
            padding-bottom: 10px;
        }
        
        .question {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #2d5016;
        }
        
        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .option-btn {
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #a8e6cf, #88d3a7);
            color: #2d5016;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .option-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .option-btn.selected {
            background: linear-gradient(135deg, #4a7c59, #3a6b49);
            color: white;
            box-shadow: 0 0 0 3px #a8e6cf;
        }
        
        .submit-area {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .result {
            font-size: 1.2rem;
            font-weight: bold;
            white-space: nowrap;
        }
        
        .correct {
            color: #4a7c59;
        }
        
        .incorrect {
            color: #e74c3c;
        }
        
        .emoji {
            font-size: 1.5rem;
        }
        
        /* ÊäΩÂ•ñÊåâÈíÆÊ†∑Âºè - Âú®Á≠îÈ¢òÂå∫ÂÜÖ */
        .lottery-section {
            margin-top: auto;
            padding-top: 20px;
            border-top: 2px dashed #a8e6cf;
            text-align: center;
        }
        
        .lottery-btn {
            padding: 12px 24px;
            background: linear-gradient(90deg, #FF6B6B, #FF8E8E);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 250px;
        }
        
        .lottery-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
            background: linear-gradient(90deg, #FF5252, #FF7B7B);
        }
        
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        .success-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        
        .success-modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 90%;
            z-index: 201;
            position: relative;
        }
        
        .modal-content h2 {
            color: #4a7c59;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        
        .modal-content p {
            margin-bottom: 12px;
            font-size: 1.1rem;
            color: #2d5016;
            line-height: 1.5;
        }
        
        .modal-btn {
            padding: 10px 25px;
            background: linear-gradient(90deg, #4a7c59, #3a6b49);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }
        
        .annotation-mode {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 300;
            background: rgba(255, 255, 255, 0.9);
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: none;
        }
        
        .annotation-mode.active {
            display: block;
        }
        
        .annotation-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 250;
        }
        
        .annotation-canvas.drawing {
            pointer-events: all;
        }
        
        /* ÊäΩÂ•ñÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .lottery-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 400;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        
        .lottery-modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .lottery-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            max-width: 450px;
            width: 90%;
            position: relative;
        }
        
        .lottery-content h2 {
            color: #FF6B6B;
            margin-bottom: 20px;
            font-size: 2rem;
        }
        
        .lottery-number {
            font-size: 4rem;
            font-weight: bold;
            color: #FF6B6B;
            margin: 25px 0;
            text-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #FFE8E8, #FFF5F5);
            border-radius: 15px;
            border: 3px dashed #FF6B6B;
        }
        
        .lottery-result {
            font-size: 1.3rem;
            margin: 15px 0;
            color: #4a7c59;
            font-weight: bold;
        }
        
        .lottery-btn-close {
            padding: 10px 25px;
            background: linear-gradient(90deg, #4a7c59, #3a6b49);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-top: 15px;
        }
        
        .lottery-btn-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }
        
        @media (max-width: 900px) {
            .container {
                flex-direction: column;
            }
            
            .control-panel {
                flex-direction: column;
                align-items: stretch;
            }
            
            .level-buttons {
                justify-content: center;
            }
            
            .zoom-control {
                margin-left: 0;
                margin-top: 8px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>ÂéòÁ±≥ÊµãÈáèÂ§ßÈóØÂÖ≥</h1>
    </header>
    
    <div class="container">
        <div class="game-area">
            <div class="workbench">
                <div class="workbench-title">Êìç‰ΩúÂè∞ - ÊãñÂä®Â∞èÊ£í„ÄÅÂ∞∫Â≠êËøõË°åÊµãÈáè</div>
                
                <!-- Â∞èÊ£í -->
                <div class="rod rod-1" data-length="6">
                    <span class="rod-label">Â∞èÊ£í A</span>
                </div>
                <div class="rod rod-2" data-length="5">
                    <span class="rod-label">Â∞èÊ£í B</span>
                </div>
                
                <!-- Á¨¨‰∏âÂÖ≥ÁöÑÂ∞èÊ£í -->
                <div class="rod-small rod-1cm" data-length="1">
                    <span class="rod-label">1cm</span>
                </div>
                <div class="rod-small rod-2cm" data-length="2">
                    <span class="rod-label">2cm</span>
                </div>
                <div class="rod-small rod-3cm" data-length="3">
                    <span class="rod-label">3cm</span>
                </div>
                <div class="rod-small rod-4cm" data-length="4">
                    <span class="rod-label">4cm</span>
                </div>
                <div class="rod-small rod-5cm" data-length="5">
                    <span class="rod-label">5cm</span>
                </div>
                <div class="rod-small rod-6cm" data-length="6">
                    <span class="rod-label">6cm</span>
                </div>
                
                <!-- Â∞∫Â≠ê -->
                <div class="ruler-container" id="rulerContainer">
                    <div class="ruler" id="ruler">
                        <!-- ÂàªÂ∫¶Â∞∫Â∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>
            
            <div class="control-panel">
                <div class="level-buttons">
                    <button class="level-btn active" data-level="1">Á¨¨‰∏ÄÂÖ≥</button>
                    <button class="level-btn" data-level="2">Á¨¨‰∫åÂÖ≥</button>
                    <button class="level-btn" data-level="3">Á¨¨‰∏âÂÖ≥</button>
                    
                    <div class="zoom-control">
                        <span class="zoom-label">ÊîæÂ§ß:</span>
                        <input type="range" min="100" max="200" value="100" class="zoom-slider" id="zoomSlider">
                        <span class="zoom-label" id="zoomLevel">100%</span>
                    </div>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button id="resetBtn">ÈáçÁΩÆ‰ΩçÁΩÆ</button>
                    <button id="annotationBtn">ÊâπÊ≥®</button>
                </div>
            </div>
        </div>
        
        <div class="quiz-area">
            <h2 class="quiz-title">Á≠îÈ¢òÂå∫</h2>
            <div id="quizContent">
                <div class="question" id="question">Á¨¨‰∏ÄÂÖ≥ÔºöÂ∞èÊ£íAÁöÑÈïøÂ∫¶ÊòØ______ÂéòÁ±≥„ÄÇ</div>
                <div class="options" id="options">
                    <!-- ÈÄâÈ°πÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
                </div>
                <div class="submit-area">
                    <button id="submitBtn">Êèê‰∫§Á≠îÊ°à</button>
                    <button id="retryBtn" style="display:none;">ÈáçÊñ∞Êèê‰∫§</button>
                    <div class="result" id="result"></div>
                    <div class="emoji" id="emoji"></div>
                </div>
            </div>
            
            <!-- ÊäΩÂ•ñÂå∫Âüü - Âú®Á≠îÈ¢òÂå∫ÂÜÖ -->
            <div class="lottery-section">
                <button class="lottery-btn" id="lotteryBtn">ÊàëÊÉ≥Êù•ÈóØÂÖ≥</button>
            </div>
        </div>
    </div>

    <canvas id="confetti-canvas"></canvas>
    
    <!-- ÊàêÂäüÂºπÁ™ó -->
    <div class="success-modal" id="successModal">
        <div class="modal-content">
            <h2>ÈóØÂÖ≥ÊàêÂäüÔºÅ</h2>
            <p>ÊÅ≠Âñú‰Ω†ÂÆåÊàê‰∫ÜÊâÄÊúâÂÖ≥Âç°ÔºÅ</p>
            <p>‰Ω†Â∑≤ÁªèÊàê‰∏∫ÂéòÁ±≥ÊµãÈáèÁöÑÂ∞è‰∏ìÂÆ∂ÔºÅ</p>
            <button class="modal-btn" id="modalCloseBtn">ÁªßÁª≠Ê∏∏Êàè</button>
        </div>
    </div>

    <!-- ÊäΩÂ•ñÂºπÁ™ó -->
    <div class="lottery-modal" id="lotteryModal">
        <div class="lottery-content">
            <h2>Âπ∏ËøêÊäΩÂ•ñ</h2>
            <div class="lottery-number" id="lotteryNumber">?</div>
            <div class="lottery-result" id="lotteryResult">ÊäΩÂ•ñ‰∏≠...</div>
            <button class="lottery-btn-close" id="lotteryCloseBtn">ÂÖ≥Èó≠</button>
        </div>
    </div>

    <div class="annotation-mode" id="annotationMode">
        <h3>ÊâπÊ≥®Ê®°Âºè</h3>
        <p>Âú®È°µÈù¢‰∏äÊãñÂä®Èº†Ê†áËøõË°åÂàíÁ∫øÊ†áÊ≥®</p>
        <button id="exitAnnotationBtn">ÈÄÄÂá∫ÊâπÊ≥®</button>
    </div>

    <canvas class="annotation-canvas" id="annotationCanvas"></canvas>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Ê∏∏ÊàèÁä∂ÊÄÅ
            const gameState = {
                currentLevel: 1,
                selectedRod: null,
                rods: [
                    { id: 'A', length: 6 },
                    { id: 'B', length: 5 }
                ],
                answers: {
                    1: 6, // Á¨¨‰∏ÄÂÖ≥Ê≠£Á°ÆÁ≠îÊ°à
                    2: 5, // Á¨¨‰∫åÂÖ≥Ê≠£Á°ÆÁ≠îÊ°à
                    3: [1,2,3,4,5,6] // Á¨¨‰∏âÂÖ≥Ê≠£Á°ÆÁ≠îÊ°à
                },
                userAnswers: {
                    1: null,
                    2: null,
                    3: []
                },
                completedLevels: {
                    1: false,
                    2: false,
                    3: false
                }
            };
            
            // DOMÂÖÉÁ¥†
            const ruler = document.getElementById('ruler');
            const rulerContainer = document.getElementById('rulerContainer');
            const levelButtons = document.querySelectorAll('.level-btn');
            const resetBtn = document.getElementById('resetBtn');
            const annotationBtn = document.getElementById('annotationBtn');
            const exitAnnotationBtn = document.getElementById('exitAnnotationBtn');
            const annotationMode = document.getElementById('annotationMode');
            const annotationCanvas = document.getElementById('annotationCanvas');
            const rods = document.querySelectorAll('.rod');
            const smallRods = document.querySelectorAll('.rod-small');
            const question = document.getElementById('question');
            const options = document.getElementById('options');
            const submitBtn = document.getElementById('submitBtn');
            const retryBtn = document.getElementById('retryBtn');
            const result = document.getElementById('result');
            const emoji = document.getElementById('emoji');
            const confettiCanvas = document.getElementById('confetti-canvas');
            const successModal = document.getElementById('successModal');
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            
            // ÊäΩÂ•ñÁõ∏ÂÖ≥ÂÖÉÁ¥†
            const lotteryBtn = document.getElementById('lotteryBtn');
            const lotteryModal = document.getElementById('lotteryModal');
            const lotteryNumber = document.getElementById('lotteryNumber');
            const lotteryResult = document.getElementById('lotteryResult');
            const lotteryCloseBtn = document.getElementById('lotteryCloseBtn');
            
            // ÊîæÂ§ßÈïúÁõ∏ÂÖ≥ÂÖÉÁ¥†
            const zoomSlider = document.getElementById('zoomSlider');
            const zoomLevel = document.getElementById('zoomLevel');
            
            // ÂàùÂßãÂåñÊ∏∏Êàè
            initGame();
            
            // ‰∫ã‰ª∂ÁõëÂê¨
            levelButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const level = parseInt(this.getAttribute('data-level'));
                    changeLevel(level);
                });
            });
            
            resetBtn.addEventListener('click', resetPositions);
            submitBtn.addEventListener('click', submitAnswer);
            retryBtn.addEventListener('click', resetQuiz);
            modalCloseBtn.addEventListener('click', closeModal);
            annotationBtn.addEventListener('click', startAnnotation);
            exitAnnotationBtn.addEventListener('click', exitAnnotation);
            
            // ÊäΩÂ•ñ‰∫ã‰ª∂ÁõëÂê¨
            lotteryBtn.addEventListener('click', startLottery);
            lotteryCloseBtn.addEventListener('click', closeLottery);
            
            // ÊîæÂ§ßÈïú‰∫ã‰ª∂ÁõëÂê¨
            zoomSlider.addEventListener('input', handleZoom);
            
            // Â∞èÊ£íÁÇπÂáª‰∫ã‰ª∂ - ÁßªÈô§ÊâÄÊúâÁÇπÂáªÊïàÊûú
            rods.forEach(rod => {
                rod.addEventListener('mousedown', function(e) {
                    e.preventDefault();
                });
            });
            
            smallRods.forEach(rod => {
                rod.addEventListener('mousedown', function(e) {
                    e.preventDefault();
                });
            });
            
            // ÂàùÂßãÂåñÊ∏∏Êàè
            function initGame() {
                createRuler();
                setupDragAndDrop();
                createOptions();
                updateRodVisibility();
                setInitialPositions();
            }
            
            // Â§ÑÁêÜÁº©Êîæ
            function handleZoom() {
                const zoomValue = parseInt(zoomSlider.value);
                zoomLevel.textContent = zoomValue + '%';
                
                const scale = zoomValue / 100;
                
                // Âè™Áº©ÊîæÂ∞∫Â≠êÂíåÂ∞èÊ£í
                const allRods = document.querySelectorAll('.rod, .rod-small');
                allRods.forEach(rod => {
                    rod.style.transform = `scale(${scale})`;
                });
                
                rulerContainer.style.transform = `scale(${scale})`;
            }
            
            // ËÆæÁΩÆÂàùÂßã‰ΩçÁΩÆ - Â∞èÊ£íÂíåÂ∞∫Â≠êÂ∫ïÈÉ®ÂØπÈΩê
            function setInitialPositions() {
                // Â∫ïÈÉ®‰ΩçÁΩÆ
                const bottomPosition = 50;
                
                // ËÆæÁΩÆÂ∞∫Â≠ê‰ΩçÁΩÆ
                rulerContainer.style.right = '50px';
                rulerContainer.style.bottom = bottomPosition + 'px';
                
                // ËÆæÁΩÆÂ∞èÊ£í‰ΩçÁΩÆ - ‰∏éÂ∞∫Â≠êÂ∫ïÈÉ®ÂØπÈΩê
                document.querySelector('.rod-1').style.left = '50px';
                document.querySelector('.rod-1').style.bottom = bottomPosition + 'px';
                
                document.querySelector('.rod-2').style.left = '50px';
                document.querySelector('.rod-2').style.bottom = bottomPosition + 'px';
                
                // ËÆæÁΩÆÁ¨¨‰∏âÂÖ≥Â∞èÊ£íÁöÑÂàùÂßã‰ΩçÁΩÆÔºà6cm‰∏éÂ∞∫Â≠êÂ∫ïÈÉ®ÂØπÈΩêÔºåÈó¥Ë∑ù30pxÔºâ
                const smallRodPositions = [
                    { left: '50px', bottom: '200px' },  // 1cm
                    { left: '50px', bottom: '170px' },  // 2cm
                    { left: '50px', bottom: '140px' },  // 3cm
                    { left: '50px', bottom: '110px' },  // 4cm
                    { left: '50px', bottom: '80px' },   // 5cm
                    { left: '50px', bottom: bottomPosition + 'px' }    // 6cm ‰∏éÂ∞∫Â≠êÂ∫ïÈÉ®ÂØπÈΩê
                ];
                
                smallRods.forEach((rod, index) => {
                    if (index < smallRodPositions.length) {
                        rod.style.left = smallRodPositions[index].left;
                        rod.style.bottom = smallRodPositions[index].bottom;
                    }
                });
            }
            
            // Êõ¥Êñ∞Â∞èÊ£íÂèØËßÅÊÄß
            function updateRodVisibility() {
                const rod1 = document.querySelector('.rod-1');
                const rod2 = document.querySelector('.rod-2');
                
                // ÊòæÁ§∫/ÈöêËóèÁ¨¨‰∏âÂÖ≥ÁöÑÂ∞èÊ£í
                smallRods.forEach(rod => {
                    if (gameState.currentLevel === 3) {
                        rod.style.display = 'flex';
                    } else {
                        rod.style.display = 'none';
                    }
                });
                
                switch(gameState.currentLevel) {
                    case 1:
                        rod1.style.display = 'flex';
                        rod2.style.display = 'none';
                        break;
                    case 2:
                        rod1.style.display = 'none';
                        rod2.style.display = 'flex';
                        break;
                    case 3:
                        rod1.style.display = 'none';
                        rod2.style.display = 'none';
                        break;
                }
            }
            
            // ÂàõÂª∫ÂàªÂ∫¶Â∞∫
            function createRuler() {
                ruler.innerHTML = '';
                const rulerWidth = 300; // Â∞∫Â≠êÂÆΩÂ∫¶ (10cm)
                const cmWidth = rulerWidth / 10; // ÊØèÂéòÁ±≥ÂÆΩÂ∫¶
                
                // Ê†πÊçÆÂΩìÂâçÂÖ≥Âç°ÂàõÂª∫‰∏çÂêåÁöÑÂàªÂ∫¶Â∞∫
                for (let i = 0; i <= 10; i++) {
                    const showNumber = getNumberForLevel(i) !== '';
                    const showLine = shouldShowLine(i);
                    
                    if (showLine) {
                        const line = document.createElement('div');
                        line.className = 'ruler-line';
                        line.style.left = (i * cmWidth) + 'px';
                        // ÊâÄÊúâÂàªÂ∫¶Á∫øÁªü‰∏ÄÈ´òÂ∫¶‰∏∫10%
                        line.style.height = '10%';
                        
                        ruler.appendChild(line);
                    }
                    
                    // Ê∑ªÂä†Êï∞Â≠ó
                    if (showNumber) {
                        const number = document.createElement('div');
                        number.className = 'ruler-number';
                        number.textContent = getNumberForLevel(i);
                        number.style.left = (i * cmWidth) + 'px';
                        
                        ruler.appendChild(number);
                    }
                }
            }
            
            // Ê†πÊçÆÂÖ≥Âç°Ëé∑ÂèñÂàªÂ∫¶Êï∞Â≠ó
            function getNumberForLevel(i) {
                switch(gameState.currentLevel) {
                    case 1:
                        return i; // ÂÆåÊï¥ÂàªÂ∫¶
                    case 2:
                        // ÈÉ®ÂàÜÊï∞Â≠óËÑ±ËêΩÔºàÂéªÊéâ3„ÄÅ5„ÄÅ8Ôºâ
                        if (i === 0 || i === 1 || i === 2 || i === 4 || i === 6 || i === 7 || i === 9 || i === 10) {
                            return i;
                        }
                        return '';
                    case 3:
                        // Âè™ÊúâÂ∞ëÊï∞ÂàªÂ∫¶‰øùÁïô
                        if (i === 0 || i === 1 || i === 4 || i === 6) {
                            return i;
                        }
                        return '';
                    default:
                        return i;
                }
            }
            
            // Âà§Êñ≠ÊòØÂê¶Â∫îËØ•ÊòæÁ§∫ÂàªÂ∫¶Á∫ø
            function shouldShowLine(i) {
                switch(gameState.currentLevel) {
                    case 1:
                        return true; // ÂÆåÊï¥ÂàªÂ∫¶Á∫ø
                    case 2:
                        // ÈÉ®ÂàÜÂàªÂ∫¶Á∫øÊ∂àÂ§±Ôºà‰∏éÊï∞Â≠óÊ∂àÂ§±‰∏ÄËá¥Ôºâ
                        if (i === 0 || i === 1 || i === 2 || i === 4 || i === 6 || i === 7 || i === 9 || i === 10) {
                            return true;
                        }
                        return false;
                    case 3:
                        // Âè™ÊúâÂ∞ëÊï∞ÂàªÂ∫¶Á∫ø‰øùÁïô
                        if (i === 0 || i === 1 || i === 4 || i === 6) {
                            return true;
                        }
                        return false;
                    default:
                        return true;
                }
            }
            
            // ÂàõÂª∫ÈÄâÈ°π
            function createOptions() {
                options.innerHTML = '';
                
                if (gameState.currentLevel === 3) {
                    // Á¨¨‰∏âÂÖ≥ÊòØÂ§öÈÄâÈ¢ò
                    for (let i = 1; i <= 10; i++) {
                        const optionBtn = document.createElement('button');
                        optionBtn.className = 'option-btn';
                        optionBtn.textContent = i;
                        optionBtn.dataset.value = i;
                        
                        optionBtn.addEventListener('click', function() {
                            this.classList.toggle('selected');
                            const value = parseInt(this.dataset.value);
                            
                            if (this.classList.contains('selected')) {
                                if (!gameState.userAnswers[3].includes(value)) {
                                    gameState.userAnswers[3].push(value);
                                }
                            } else {
                                const index = gameState.userAnswers[3].indexOf(value);
                                if (index > -1) {
                                    gameState.userAnswers[3].splice(index, 1);
                                }
                            }
                        });
                        
                        options.appendChild(optionBtn);
                    }
                } else {
                    // Á¨¨‰∏ÄÂÖ≥ÂíåÁ¨¨‰∫åÂÖ≥ÊòØÂçïÈÄâÈ¢ò
                    for (let i = 1; i <= 10; i++) {
                        const optionBtn = document.createElement('button');
                        optionBtn.className = 'option-btn';
                        optionBtn.textContent = i;
                        optionBtn.dataset.value = i;
                        
                        optionBtn.addEventListener('click', function() {
                            // ÁßªÈô§ÂÖ∂‰ªñÈÄâÈ°πÁöÑÈÄâÊã©Áä∂ÊÄÅ
                            document.querySelectorAll('.option-btn').forEach(btn => {
                                btn.classList.remove('selected');
                            });
                            
                            // ËÆæÁΩÆÂΩìÂâçÈÄâÈ°π‰∏∫ÈÄâ‰∏≠Áä∂ÊÄÅ
                            this.classList.add('selected');
                            
                            // Êõ¥Êñ∞Áî®Êà∑Á≠îÊ°à
                            gameState.userAnswers[gameState.currentLevel] = parseInt(this.dataset.value);
                        });
                        
                        options.appendChild(optionBtn);
                    }
                }
            }
            
            // ËÆæÁΩÆÊãñÊîæÂäüËÉΩ
            function setupDragAndDrop() {
                // ËÆæÁΩÆÂ∞èÊ£íÂèØÊãñÂä®
                rods.forEach(rod => {
                    setupDraggable(rod);
                });
                
                // ËÆæÁΩÆÁ¨¨‰∏âÂÖ≥Â∞èÊ£íÂèØÊãñÂä®
                smallRods.forEach(rod => {
                    setupDraggable(rod);
                });
                
                // ËÆæÁΩÆÂ∞∫Â≠êÂèØÊãñÂä®
                setupDraggable(rulerContainer);
            }
            
            // ËÆæÁΩÆÂÖÉÁ¥†ÂèØÊãñÂä®
            function setupDraggable(element) {
                let isDragging = false;
                let startX, startY;
                let initialLeft, initialTop;
                let dragThreshold = 5; // ÊãñÂä®ÈòàÂÄºÔºåÈÅøÂÖçÁÇπÂáªÊó∂ËØØËß¶ÂèëÊãñÂä®
                
                element.addEventListener('mousedown', startDrag);
                
                function startDrag(e) {
                    // Ê£ÄÊü•ÊòØÂê¶ÊòØÂ∑¶ÈîÆÁÇπÂáª
                    if (e.button !== 0) return;
                    
                    isDragging = false; // ÂàùÂßãÁä∂ÊÄÅ‰∏çÊòØÊãñÂä®
                    startX = e.clientX;
                    startY = e.clientY;
                    
                    // Ëé∑ÂèñÂΩìÂâçÂÖÉÁ¥†‰ΩçÁΩÆ
                    const computedStyle = window.getComputedStyle(element);
                    initialLeft = parseInt(computedStyle.left) || 0;
                    initialTop = parseInt(computedStyle.top) || 0;
                    
                    document.addEventListener('mousemove', checkDrag);
                    document.addEventListener('mouseup', stopDrag);
                    
                    e.preventDefault();
                }
                
                function checkDrag(e) {
                    if (!isDragging) {
                        // Ê£ÄÊü•ÊòØÂê¶ËææÂà∞ÊãñÂä®ÈòàÂÄº
                        const deltaX = Math.abs(e.clientX - startX);
                        const deltaY = Math.abs(e.clientY - startY);
                        
                        if (deltaX > dragThreshold || deltaY > dragThreshold) {
                            isDragging = true;
                            // ÁßªÈô§ÁÇπÂáªÊ£ÄÊü•ÔºåÂºÄÂßãÁúüÊ≠£ÁöÑÊãñÂä®
                            document.removeEventListener('mousemove', checkDrag);
                            document.addEventListener('mousemove', drag);
                        }
                    }
                }
                
                function drag(e) {
                    if (!isDragging) return;
                    
                    const currentX = e.clientX;
                    const currentY = e.clientY;
                    const deltaX = currentX - startX;
                    const deltaY = currentY - startY;
                    
                    let newLeft = initialLeft + deltaX;
                    let newTop = initialTop + deltaY;
                    
                    // ÈôêÂà∂ÂÖÉÁ¥†ÁßªÂä®ËåÉÂõ¥
                    const workbench = document.querySelector('.workbench');
                    const maxLeft = workbench.offsetWidth - element.offsetWidth;
                    const maxTop = workbench.offsetHeight - element.offsetHeight;
                    
                    if (newLeft < 0) newLeft = 0;
                    if (newLeft > maxLeft) newLeft = maxLeft;
                    if (newTop < 0) newTop = 0;
                    if (newTop > maxTop) newTop = maxTop;
                    
                    element.style.left = newLeft + 'px';
                    element.style.top = newTop + 'px';
                }
                
                function stopDrag() {
                    isDragging = false;
                    document.removeEventListener('mousemove', checkDrag);
                    document.removeEventListener('mousemove', drag);
                    document.removeEventListener('mouseup', stopDrag);
                }
            }
            
            // ÂºÄÂßãÊâπÊ≥®Ê®°Âºè
            function startAnnotation() {
                annotationMode.classList.add('active');
                annotationCanvas.classList.add('drawing');
                
                // ËÆæÁΩÆÁîªÂ∏ÉÂ∞∫ÂØ∏
                annotationCanvas.width = window.innerWidth;
                annotationCanvas.height = window.innerHeight;
                
                const ctx = annotationCanvas.getContext('2d');
                let isDrawing = false;
                let lastX = 0;
                let lastY = 0;
                
                // ËÆæÁΩÆÁîªÁ¨îÊ†∑Âºè
                ctx.strokeStyle = '#e74c3c';
                ctx.lineWidth = 3;
                ctx.lineJoin = 'round';
                ctx.lineCap = 'round';
                
                function startDrawing(e) {
                    isDrawing = true;
                    [lastX, lastY] = [e.clientX, e.clientY];
                }
                
                function draw(e) {
                    if (!isDrawing) return;
                    
                    ctx.beginPath();
                    ctx.moveTo(lastX, lastY);
                    ctx.lineTo(e.clientX, e.clientY);
                    ctx.stroke();
                    
                    [lastX, lastY] = [e.clientX, e.clientY];
                }
                
                function stopDrawing() {
                    isDrawing = false;
                }
                
                // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨
                annotationCanvas.addEventListener('mousedown', startDrawing);
                annotationCanvas.addEventListener('mousemove', draw);
                annotationCanvas.addEventListener('mouseup', stopDrawing);
                annotationCanvas.addEventListener('mouseout', stopDrawing);
            }
            
            // ÈÄÄÂá∫ÊâπÊ≥®Ê®°Âºè
            function exitAnnotation() {
                annotationMode.classList.remove('active');
                annotationCanvas.classList.remove('drawing');
                
                // Ê∏ÖÈô§ÁîªÂ∏É
                const ctx = annotationCanvas.getContext('2d');
                ctx.clearRect(0, 0, annotationCanvas.width, annotationCanvas.height);
                
                // ÁßªÈô§‰∫ã‰ª∂ÁõëÂê¨
                annotationCanvas.removeEventListener('mousedown', startDrawing);
                annotationCanvas.removeEventListener('mousemove', draw);
                annotationCanvas.removeEventListener('mouseup', stopDrawing);
                annotationCanvas.removeEventListener('mouseout', stopDrawing);
            }
            
            // ÂºÄÂßãÊäΩÂ•ñ
            function startLottery() {
                lotteryModal.classList.add('active');
                lotteryNumber.textContent = '?';
                lotteryResult.textContent = 'ÊäΩÂ•ñ‰∏≠...';
                
                let counter = 0;
                const totalNumbers = 45;
                let finalNumber = Math.floor(Math.random() * totalNumbers) + 1;
                
                // ÂàõÂª∫ÈöèÊú∫Êï∞Â≠óÊï∞ÁªÑÁî®‰∫éÊªöÂä®ÊïàÊûú
                let randomNumbers = [];
                for (let i = 0; i < 30; i++) {
                    randomNumbers.push(Math.floor(Math.random() * totalNumbers) + 1);
                }
                randomNumbers.push(finalNumber);
                
                let currentIndex = 0;
                
                // ÈöèÊú∫ÊªöÂä®ÊïàÊûú
                const interval = setInterval(() => {
                    lotteryNumber.textContent = randomNumbers[currentIndex];
                    currentIndex++;
                    
                    if (currentIndex >= randomNumbers.length) {
                        clearInterval(interval);
                        
                        // ÊòæÁ§∫ÊúÄÁªàÁªìÊûú
                        setTimeout(() => {
                            lotteryResult.textContent = `ÊÅ≠Âñú ${finalNumber} Âè∑ÂêåÂ≠¶Ëé∑ÂæóÈóØÂÖ≥Êú∫‰ºöÔºÅ`;
                            startColorfulConfetti();
                        }, 500);
                    }
                }, 100);
            }
            
            // ÂÖ≥Èó≠ÊäΩÂ•ñÂºπÁ™ó
            function closeLottery() {
                lotteryModal.classList.remove('active');
            }
            
            // Êèê‰∫§Á≠îÊ°à
            function submitAnswer() {
                const currentLevel = gameState.currentLevel;
                const userAnswer = gameState.userAnswers[currentLevel];
                const correctAnswer = gameState.answers[currentLevel];
                
                let isCorrect = false;
                
                if (currentLevel === 3) {
                    // Á¨¨‰∏âÂÖ≥ÊòØÂ§öÈÄâÈ¢ò
                    isCorrect = arraysEqual(userAnswer.sort(), correctAnswer.sort());
                } else {
                    // Á¨¨‰∏ÄÂÖ≥ÂíåÁ¨¨‰∫åÂÖ≥ÊòØÂçïÈÄâÈ¢ò
                    isCorrect = userAnswer === correctAnswer;
                }
                
                if (isCorrect) {
                    result.textContent = "ÂõûÁ≠îÊ≠£Á°ÆÔºÅ";
                    result.className = "result correct";
                    emoji.textContent = "üéâ";
                    submitBtn.style.display = "none";
                    retryBtn.style.display = "inline-block";
                    startColorfulConfetti();
                    
                    // Ê†áËÆ∞ÂÖ≥Âç°ÂÆåÊàê
                    gameState.completedLevels[currentLevel] = true;
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÊâÄÊúâÂÖ≥Âç°ÈÉΩÂÆåÊàê
                    checkAllLevelsCompleted();
                } else {
                    result.textContent = "ÂõûÁ≠îÈîôËØØÔºåËØ∑ÂÜçËØï‰∏ÄÊ¨°";
                    result.className = "result incorrect";
                    emoji.textContent = "üò¢";
                    submitBtn.style.display = "none";
                    retryBtn.style.display = "inline-block";
                }
            }
            
            // Ê£ÄÊü•ÊòØÂê¶ÊâÄÊúâÂÖ≥Âç°ÈÉΩÂÆåÊàê
            function checkAllLevelsCompleted() {
                if (gameState.completedLevels[1] && gameState.completedLevels[2] && gameState.completedLevels[3]) {
                    setTimeout(() => {
                        successModal.classList.add('active');
                        startColorfulConfetti();
                    }, 1000);
                }
            }
            
            // ÈáçÁΩÆÁ≠îÈ¢òÁä∂ÊÄÅ
            function resetQuiz() {
                result.textContent = "";
                emoji.textContent = "";
                submitBtn.style.display = "inline-block";
                retryBtn.style.display = "none";
                
                // ÈáçÁΩÆÁî®Êà∑Á≠îÊ°à
                if (gameState.currentLevel === 3) {
                    gameState.userAnswers[3] = [];
                    document.querySelectorAll('.option-btn').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                } else {
                    gameState.userAnswers[gameState.currentLevel] = null;
                    document.querySelectorAll('.option-btn').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                }
            }
            
            // ÂàáÊç¢ÂÖ≥Âç°
            function changeLevel(level) {
                gameState.currentLevel = level;
                
                // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                levelButtons.forEach(btn => {
                    if (parseInt(btn.getAttribute('data-level')) === level) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                // ÈáçÊñ∞ÂàõÂª∫ÂàªÂ∫¶Â∞∫
                createRuler();
                
                // ÈáçÁΩÆ‰ΩçÁΩÆ
                resetPositions();
                
                // Êõ¥Êñ∞ÈóÆÈ¢ò
                updateQuestion();
                
                // Êõ¥Êñ∞Â∞èÊ£íÂèØËßÅÊÄß
                updateRodVisibility();
                
                // ÂàõÂª∫ÈÄâÈ°π
                createOptions();
                
                // ÈáçÁΩÆÁ≠îÈ¢òÁä∂ÊÄÅ
                resetQuiz();
            }
            
            // Êõ¥Êñ∞ÈóÆÈ¢ò
            function updateQuestion() {
                switch(gameState.currentLevel) {
                    case 1:
                        question.textContent = "Á¨¨‰∏ÄÂÖ≥ÔºöÂ∞èÊ£íAÁöÑÈïøÂ∫¶ÊòØ______ÂéòÁ±≥„ÄÇ";
                        break;
                    case 2:
                        question.textContent = "Á¨¨‰∫åÂÖ≥ÔºöÂ∞èÊ£íBÁöÑÈïøÂ∫¶ÊòØ______ÂéòÁ±≥„ÄÇ";
                        break;
                    case 3:
                        question.textContent = "Á¨¨‰∏âÂÖ≥ÔºöÂèØ‰ª•Áî®ËøôÊääÂ∞∫Â≠êÁõ¥Êé•ÊµãÈáèÂá∫__________ÂéòÁ±≥„ÄÇ";
                        break;
                }
            }
            
            // ÈáçÁΩÆ‰ΩçÁΩÆ - Â∞èÊ£íÂíåÂ∞∫Â≠êÂ∫ïÈÉ®ÂØπÈΩê
            function resetPositions() {
                // Â∫ïÈÉ®‰ΩçÁΩÆ
                const bottomPosition = 50;
                
                // ÈáçÁΩÆÂ∞∫Â≠ê‰ΩçÁΩÆ
                rulerContainer.style.left = '';
                rulerContainer.style.top = '';
                rulerContainer.style.right = '50px';
                rulerContainer.style.bottom = bottomPosition + 'px';
                
                // ÈáçÁΩÆÂ∞èÊ£í‰ΩçÁΩÆ - ‰∏éÂ∞∫Â≠êÂ∫ïÈÉ®ÂØπÈΩê
                document.querySelector('.rod-1').style.left = '50px';
                document.querySelector('.rod-1').style.bottom = bottomPosition + 'px';
                
                document.querySelector('.rod-2').style.left = '50px';
                document.querySelector('.rod-2').style.bottom = bottomPosition + 'px';
                
                // ÈáçÁΩÆÁ¨¨‰∏âÂÖ≥Â∞èÊ£í‰ΩçÁΩÆÔºà6cm‰∏éÂ∞∫Â≠êÂ∫ïÈÉ®ÂØπÈΩêÔºåÈó¥Ë∑ù30pxÔºâ
                const smallRodPositions = [
                    { left: '50px', bottom: '200px' },  // 1cm
                    { left: '50px', bottom: '170px' },  // 2cm
                    { left: '50px', bottom: '140px' },  // 3cm
                    { left: '50px', bottom: '110px' },  // 4cm
                    { left: '50px', bottom: '80px' },   // 5cm
                    { left: '50px', bottom: bottomPosition + 'px' }    // 6cm ‰∏éÂ∞∫Â≠êÂ∫ïÈÉ®ÂØπÈΩê
                ];
                
                smallRods.forEach((rod, index) => {
                    if (index < smallRodPositions.length) {
                        rod.style.left = smallRodPositions[index].left;
                        rod.style.bottom = smallRodPositions[index].bottom;
                    }
                });
            }
            
            // ÊØîËæÉ‰∏§‰∏™Êï∞ÁªÑÊòØÂê¶Áõ∏Á≠â
            function arraysEqual(a, b) {
                if (a === b) return true;
                if (a == null || b == null) return false;
                if (a.length !== b.length) return false;
                
                for (let i = 0; i < a.length; i++) {
                    if (a[i] !== b[i]) return false;
                }
                return true;
            }
            
            // ÂÖ≥Èó≠ÊàêÂäüÂºπÁ™ó
            function closeModal() {
                successModal.classList.remove('active');
            }
            
            // ÂΩ©Ëâ≤ÂΩ©Â∏¶ÊïàÊûú
            function startColorfulConfetti() {
                const canvas = confettiCanvas;
                const ctx = canvas.getContext('2d');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                
                const confettiPieces = [];
                const colors = ['#4a7c59', '#3a6b49', '#2d5016', '#a8e6cf', '#dcedc1', 
                               '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8',
                               '#FFD166', '#06D6A0', '#118AB2', '#EF476F', '#073B4C'];
                
                // ÂàõÂª∫ÂΩ©Ëâ≤Á§ºËä±Á¢éÁâá
                for (let i = 0; i < 300; i++) {
                    confettiPieces.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height - canvas.height,
                        size: Math.random() * 12 + 8,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        speed: Math.random() * 4 + 3,
                        angle: Math.random() * 360,
                        spin: Math.random() * 10 - 5
                    });
                }
                
                function animateConfetti() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    let activePieces = 0;
                    
                    confettiPieces.forEach(piece => {
                        piece.y += piece.speed;
                        piece.x += Math.sin(piece.angle * Math.PI / 180) * 2;
                        piece.angle += piece.spin;
                        
                        if (piece.y < canvas.height) {
                            activePieces++;
                            
                            ctx.save();
                            ctx.translate(piece.x, piece.y);
                            ctx.rotate(piece.angle * Math.PI / 180);
                            ctx.fillStyle = piece.color;
                            ctx.fillRect(-piece.size/2, -piece.size/2, piece.size, piece.size);
                            ctx.restore();
                        }
                    });
                    
                    if (activePieces > 0) {
                        requestAnimationFrame(animateConfetti);
                    }
                }
                
                animateConfetti();
            }
        });
    </script>
</body>
</html>